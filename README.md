# TextPaster v2.3.1

TextPaster — локальный инструмент для хранения и быстрого вставления текстовых шаблонов. Приложение работает через глобальные горячие клавиши, каскадное меню и главное окно управления, поддерживает поиск по названию и содержимому, предпросмотр, а в v2.3 добавлены переназначаемые хоткеи и перемещение шаблонов.

## Быстрый старт

```bash
cd f:\textpaster
python textpaster.py
```

- Windows: `run_textpaster.bat`
- Linux/macOS: `python textpaster.py`

## Ключевые возможности

- Поиск по названию и содержимому (Ctrl+1) с результатами в реальном времени.
- Каскадное меню для навигации по папкам (Ctrl+2).
- Главное окно управления: создание, редактирование, удаление, поиск по дереву.
- Предпросмотр содержимого при наведении в поиске (v2.2).
- Переназначение горячих клавиш и перемещение шаблонов/папок (v2.3).

## Три способа выбрать шаблон

1. **Поиск (Ctrl+1)**
   - Введите текст, результаты обновляются в реальном времени.
   - Поиск идет по названию и содержимому, без учета регистра.
   - Enter копирует выбранный шаблон в буфер обмена.

2. **Каскадное меню (Ctrl+2)**
   - Меню в стиле Windows Проводника.
   - Наведение на папку открывает подменю.
   - Клик по шаблону копирует его в буфер.

3. **Главное окно**
   - Дерево папок и шаблонов слева.
   - Предпросмотр содержимого справа.
   - Управление через кнопки и горячие клавиши.

## Горячие клавиши

### Глобальные (в любом приложении)
- `Ctrl+1` — открыть поиск (по умолчанию, в v2.3 можно переназначить).
- `Ctrl+2` — открыть каскадное меню (по умолчанию, в v2.3 можно переназначить).

### В главном окне
- `F2` — редактировать выбранный элемент.
- `Delete` — удалить выбранный элемент.
- `Enter` — копировать шаблон в буфер обмена.
- `Ctrl+F` — фокус на поле поиска по дереву.
- `Ctrl+N` — создать шаблон.
- `Ctrl+D` — создать папку.
- `Ctrl+1` / `Ctrl+2` — открыть поиск/меню (если окно активно).

### В окне поиска (Ctrl+1)
- `↑/↓` — навигация по результатам.
- `Enter` — копировать результат.
- `Esc` — закрыть окно.

### В окне редактирования
- `Ctrl+V` / `Shift+Insert` / `Ctrl+Insert` — вставить текст.
- `Ctrl+S` / `Enter` — сохранить.
- `Esc` — отмена.

## Новое в v2.3

### Переназначение горячих клавиш
- Меню: `Настройки → Переназначить горячие клавиши`.
- Комбинации в формате pynput, например: `<alt>+p`, `<ctrl>+shift>+a`.
- Требуется перезапуск приложения для применения.
- Настройки сохраняются в `config.json`.

Пример `config.json`:
```json
{
  "hotkeys": {
    "search_templates": "<ctrl>+1",
    "cascading_menu": "<ctrl>+2"
  },
  "features": {
    "auto_paste": false
  }
}
```

### Быстрая вставка после выбора (новое)
- Включается в меню: `Настройки -> Быстрая вставка после выбора`.
- После выбора шаблона в каскадном меню выполняется вставка как Ctrl+V.
- По умолчанию выключено, настройка хранится в `config.json`.



### Перемещение шаблонов и папок
- Кнопки на панели: `Выше`, `Ниже`, `В папку`.
- Контекстное меню: `Переместить выше/ниже/в папку`.
- Порядок сохраняется в `templates.json` (используется `OrderedDict`).
- Работает для папок и шаблонов, поддерживает вложенность.

### Ограничения
- Изменение горячих клавиш требует перезапуск.
- На Windows могут требоваться права администратора.
- Системные комбинации могут быть заняты.
- Корневой узел перемещать нельзя.

## Предпросмотр (v2.2)

- Работает в окне поиска при наведении на результат.
- Задержка: 2 секунды.
- Размер окна: 380x250.
- Показ первых 500 символов (с пометкой сокращения).
- Позиционирование слева от списка (или справа, если нет места).
- В каскадное меню не встроен.

## Изменения v2.3.1 (обновление окон)

- Главное окно увеличено с 800x600 до 1050x700.
- Диалог переназначения горячих клавиш увеличен с 500x350 до 550x420.
- Цель: все кнопки и элементы интерфейса видны без обрезания.

## Формат данных

### templates.json
Хранит дерево папок и шаблонов:
```json
{
  "name": "Root",
  "content": "",
  "is_folder": true,
  "children": {
    "Приветствия": { "is_folder": true, "children": { ... } },
    "Подписи": { "is_folder": true, "children": { ... } }
  }
}
```

### config.json
Хранит пользовательские горячие клавиши (см. раздел v2.3).

## Системные требования

- Python 3.7+
- Windows 7/10/11, macOS 10.12+, Linux (Xorg/Wayland)
- Права на запись в директории проекта
- Для глобальных хоткеев на Windows часто нужны права администратора

## Зависимости

- `tkinter` (обычно встроен в Python)
- `pyperclip` (буфер обмена)
- `pynput` (глобальные хоткеи)

Установка:
```bash
pip install -r requirements.txt
```

Дополнительно:
- Linux: `sudo apt-get install python3-tk`
- Linux (буфер): `sudo apt-get install xclip` или `xsel`
- Linux (хоткеи): `sudo apt-get install python3-xlib`

## Решение проблем (кратко)

- **Глобальные хоткеи не работают:** запустите от администратора, проверьте антивирус, используйте кнопки в главном окне как обходной путь.
- **Нет tkinter:** установите `python3-tk` (Linux).
- **Нет pyperclip/pynput:** `pip install pyperclip pynput`.
- **templates.json поврежден:** удалите файл, будет создан новый с примерами.
- **Проблемы кодировки:** убедитесь, что `templates.json` в UTF-8, используйте `PYTHONIOENCODING=utf-8`.

## Тестирование и качество

- Проведены проверки импорта модулей.
- Проверены: ConfigManager, перемещение элементов, сохранение порядка, валидность JSON.
- Сообщается о полной обратной совместимости с v2.2.

## История версий (сводка)

- **v2.3** (23.12.2025): переназначение хоткеев, перемещение шаблонов, новые диалоги и кнопки.
- **v2.2** (2024): предпросмотр в окне поиска (2 сек, 500 символов).
- **v2.1** (2024): исправлен критический запуск, полностью переделан Ctrl+1 (поиск по названию и содержимому).
- **v2.0**: базовый функционал, каскадное меню Ctrl+2.

## Документация в проекте

Полная история и подробные гайды находятся в `.md` файлах корня и папки `docs/`. Их содержание объединено в этом README, а исходные файлы остаются для справки и детализации (инструкции, отчеты, changelog, troubleshooting, quick start).

## Идеи для будущих версий

- Drag-and-drop для перемещения.
- Undo/Redo.
- Профили горячих клавиш.
- Дополнительные горячие клавиши для операций в UI.

---

Если нужно, могу добавить разделы для конкретного сценария использования или оформить README под релиз на GitHub.
